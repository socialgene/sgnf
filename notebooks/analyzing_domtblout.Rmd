---
title: "Untitled"
output: html_document
---


Looking at what cutoff values to use

```{r}
library(data.table)
```

```{r}

outdir <- '/home/chase/Documents/socialgene_outdir'

a <- list.files(file.path(outdir, '/neo4j/import/parseddomtblout'),
                full.names = T)
a <- lapply(a,
            function(x){
            fread(x)
            })
a = do.call(rbind, a)
```

```{r}
colnames(a) <- c("target_name",
"tlen",
"query_name",
"qlen",
"E-value",
"score1",
"bias1",
"number",
"of",
"c-Evalue",
"i-Evalue",
"score2",
"bias2",
"from_hmm",
"to_hmm",
"from_ali",
"to_ali",
"from_env",
"to_env",
"acc")


```


```{r}
b <- fread(file.path(outdir, '/socialgene_hmms_info/all_hmms.tsv'))
```


```{r}
z<- merge(a, b, by.x = "query_name", by.y = "sha512t24u", all.x = T)
```


Number of annotations for each hmm db
```{r}
table(z$source)
```

i-Evalue mean

```{r}
ggplot(z[`i-Evalue`<.001, mean(`i-Evalue`), source]) + geom_point(aes(source, V1)) + ylab("Mean i-Evalue")
ggplot(z[`i-Evalue`<.001, median(`i-Evalue`), source]) + geom_point(aes(source, V1)) + ylab("Median i-Evalue")
```



Let's find a protein < 500 AA that contains the most annotations

```{r}
head(sort(table(z[tlen < 501]$`target name`), decreasing = T))
```


```{r}

protein_accessions <- file.path(outdir,
                                'neo4j/import/protein_info/protein_accessions.tsv')

read.delim(pipe(paste0("grep ", "80EtLOL9BbYVfwcNtVWCU0dQsGDa_gXb ", shQuote(protein_accessions))), sep = "\t",header = F)
```

>WP_013288221.1 MULTISPECIES: acetyl-CoA C-acetyltransferase [Micromonospora]
MASVIVSGARTPMGRLLGNLKDLPATKLGGIAIKAALERAGVAPEQVQYVIMGQVLQAGAGQIPARQAAV
EAGIPMSTPALTINKVCLSGLDAIALADQLIRAGEFDVVVAGGMESMTNAPHLLLGQRSGYKYGDVTVKD
HMALDGLTDAWDCCSMGESTERHGAKHGITREEQDAFSAASHQRAAAAQKNGHFGDEITPVVIPQRKGDP
LVISEDEGIRPDTTAESLGKLRPAFAKDGTITAGSSSPISDGAAAVVVMSKAKAKELGLTWLAEIGAHGN
VAGPDNSLHSQPSNAINHALKKGGLSIEDLDLIEINEAFAAVGIQSTRDLGISPDKVNVNGGAIALGHPI
GMSGARLVLTLAMELKRRGGGTGAAALCGGGGQGDALIIHVPNGAES


```{r}
table(z[`target name` == "80EtLOL9BbYVfwcNtVWCU0dQsGDa_gXb"]$source)
```

TO get same results as https://www.ebi.ac.uk/Tools/hmmer

```{r}
bro = (z[`target name` == "80EtLOL9BbYVfwcNtVWCU0dQsGDa_gXb"])
bro = bro[`i-Evalue` < 10]
bro[source =="pfam"]
```



```{r}
bro[source == "bigslice"]
```















```{r}
z <- z[source == "pfam"]
```


From http://pfam.xfam.org/search/sequence/results/711FB91E-FAB4-11EB-9FD3-B9220695EB6A

chose row 8

Family 	Description 	Entry
type 	Clan 	Envelope 	Alignment 	HMM 	HMM
length 	Bit
score 	E-value 	Predicted
active sites 	Show/hide
alignment
Start 	End 	Start 	End 	From 	To
Proton_antipo_M 	Proton-conducting membrane transporter 	Domain 	CL0425 	125 	415 	125 	410 	1 	288 	293 	202.3 	9.1e-60 	n/a 	Show
MnhB 	Domain related to MnhB subunit of Na+/H+ … 	Domain 	n/a 	789 	912 	789 	911 	1 	122 	124 	109.1 	1.7e-31 	n/a 	Show


DUF4040 	Domain of unknown function (DUF4040) 	Domain 	n/a 	596 	661 	597 	661 	2 	67 	67 	80.6 	6.7e-23 	n/a 	Show


Proton_antipo_N 	NADH-Ubiquinone oxidoreductase (complex … 	Domain 	n/a 	57 	113 	59 	111 	3 	56 	58 	30.6 	2.6e-07 	n/a 	Show
```{r}
z[`query name`=="LpsVPpaxMBriOwAKI0UTBMa3H9eKbojW"][`target name` == "iEScJFk846fg2LXTS28aSqfbhsD7R9Pi"]
```





```{r}
yo=z[`target name` == "iEScJFk846fg2LXTS28aSqfbhsD7R9Pi"]
```


```{r}
plot(yo$`i-Evalue`, yo$score2)
text(yo$`i-Evalue`, yo$score2, labels = yo$name)
```

PF00108.25
PF02803.20
PF02803.20
PF00109.28
PF00109.28
PF00109.28
PF07451.13
PF07451.13
PF08545.12
PF08545.12
